### Домашнее задание
#### Работа с загрузчиком
##### Цель:
  Зайти в систему без пароля рута - базовая задача сисадмина ( ну и одно из заданий на любой линуксовой сертификации). Так же нужно уметь управлять поведением загрузчика. Это и будем учиться делать в ДЗ.

1. Попасть в систему без пароля несколькими способами
2. Установить систему с LVM, после чего переименовать VG
3. Добавить модуль в initrd
4. *Сконфигурировать систему без отдельного раздела с /boot, а только с LVM. Репозиторий с пропатченым grub: https://yum.rumyantsev.com/centos/7/x86_64/. PV необходимо инициализировать с параметром --bootloaderareasize 1m

### Домашняя работа

##### Цель:
  Зайти в систему под root неколькими способами.

###### Решение 1.

1. В меню загрузки нажимаем **e**
2. Находим строку, начинающуюся с **linux16**
3. Меняем в ней **ro** на **rw**, чтобы файловая система подмонтировалась в режиме записи и дописываем в конец **init=/bin/bash**
4. Удаляем в ней **rhgb quet** для включения системных сообщений
5. Продолжаем загрузку **Ctrl + x**
6. Меняем пароль используя - **passwd root**
7. Если SELinux включен, то создаем файл **touch /.autorelabel** , который нужен для обновления информации selinux и переазметки маркеров ФС, в противном случае этот шаг можно пропустить.
8. Выполняем - **exec /sbin/init**

###### Решение 2

1. В меню загрузки нажимаем **e**
2. Находим строку, начинающуюся с **linux16**
3. Меняем в ней **ro** на **rw init=/sysroot/bin/sh**, чтобы файловая система подмонтировалась в режиме записи
4. Удаляем в ней **rhgb quet** для включения системных сообщений
5. Продолжаем загрузку **Ctrl + x**
6. Выполняем команду **chroot /sysroot**
7. Меняем пароль используя - **passwd root**
8. Если SELinux включен, то создаем файл **touch /.autorelabel** , который нужен для обновления информации selinux и переазметки маркеров ФС, в противном случае этот шаг можно пропустить.
9. Выполняем - **exit** и **exit**

###### Решение 3. RedHat SA Guide.

1. В меню загрузки нажимаем **e**
2. Находим строку, начинающуюся с **linux16**
3. Меняем в ней **ro** на **rw**, чтобы файловая система подмонтировалась в режиме записи и дописываем в конец **systemd.debug-shell selinux=0**
4. Удаляем в ней **rhgb quet** для включения системных сообщений
5. Продолжаем загрузку Ctrl + x
6. Переключаемся в консоль отладки сразу под root **Alt+F9** или **Ctrl+Alt+F9**
7. Меняем пароль используя - **passwd**
8. Перезагружаемся

###### Решение 4. RedHat SA Guide.

1. В меню загрузки нажимаем **e**
2. Находим строку, начинающуюся с **linux16**
3. Дописываем в конец **rd.break** - прерывает передачу контроля от initramfs к ядру, и **enforcing=0** - включает процесс переразметки SELinux  
4. Удаляем в ней **rhgb quet** для включения системных сообщений
5. Продолжаем загрузку **Ctrl + x**
6. Перемонтируем для записи **mount -o remount,rw /sysroot**
7. Выполняем команду **chroot /sysroot**
8. Меняем пароль используя - **passwd**
8. Если SELinux включен, то создаем файл **touch /.autorelabel** , который нужен для обновления информации selinux и переазметки маркеров ФС, в противном случае этот шаг можно пропустить. Если в пункте 3 добавили опцию **enforcing=0**, то этот пункт так же можно пропустить.
9. Перемонтируем для чтения **mount -o remount,ro /**
10. Выходим из окружения chroot **exit**
11. Выполняем **exit** и ждём окончания загрузки.


PS  Процесс переразметки SELinux может занят продолжительное время на больших диска. Перезагрузка системы произойдет автоматически после завершения процесса.
PPS Если была использована опция **enforcing=0** и выполнена команда **touch /.autorelabel** необходимо восстановить файлы SELinux в /etc/shadow

**restorecon /etc/shadow**
**setenforce 1**
**getenforce**

